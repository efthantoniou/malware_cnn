import re
import shutil
import glob
import os
import sys

path = "/home/zed/Documents/projects/data_images/"

file_log = "ESET_VirusShare_00320.txt"

destination = "/home/zed/Documents/projects/data/"

folder_files = re.findall('[0-9]+', file_log)[0]

print(folder_files)

pattern = re.compile(r"[a-zA-Z0-9]+(?:/|\.)[a-zA-Z0-9\.]+")



with open(file_log, "r", encoding='utf-8') as f:

    file_names, class_names = map(list, zip(*[(x.split('-')[0].split('\\')[-1].strip(), \
    x.split('-')[1].strip()) for i, x in enumerate(f) if i >= 4])) # 4 for 00320, 5 for other files.

class_names = [ re.findall(pattern, x) for x in class_names]

class_names = [ x[0].replace('/', '_') if x != [] else x.append('unsupported') for x in class_names]

test_files = glob.glob(path + folder_files +"/*")
print(len(test_files))
test_files = [x.strip(path + folder_files + "/") for x in test_files]
test_files = [x.replace('.', '') for x in test_files]
test_files = test_files[1:]
print(len(file_names))

for i, f in enumerate(file_names):
    if f in test_files:
        file_location =  path + folder_files + '/' + f + '.png'
        folder_location = destination + class_names[i]
        os.makedirs(folder_location, exist_ok=True)
        shutil.copy(file_location, folder_location)
    else:
        continue


#print(file_names)
#print(class_names)
